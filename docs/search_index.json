[["hypothesis-testing-for-categorical-data.html", "Module 7 Hypothesis testing for categorical data 7.1 Pearson’s chi-squared test 7.2 Chi-squared test for tables larger than 2-by-2 7.3 McNemar’s test for paired proportions", " Module 7 Hypothesis testing for categorical data 7.1 Pearson’s chi-squared test 7.1.1 Individual data We will demonstrate how to use R to conduct a Pearson chi-squared test using Worked Example 7.1. library(jmv) nausea &lt;- readRDS(&quot;data/examples/Example_7.1.rds&quot;) head(nausea) ## group side_effect ## 1 Placebo Nausea ## 2 Placebo Nausea ## 3 Placebo Nausea ## 4 Placebo Nausea ## 5 Placebo No nausea ## 6 Placebo No nausea str(nausea$group) ## Factor w/ 2 levels &quot;Placebo&quot;,&quot;Active&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## - attr(*, &quot;label&quot;)= chr &quot;Group&quot; str(nausea$side_effect) ## Factor w/ 2 levels &quot;No nausea&quot;,&quot;Nausea&quot;: 2 2 2 2 1 1 1 1 1 1 ... ## - attr(*, &quot;label&quot;)= chr &quot;Side effect&quot; The columns group and side_effect have been entered as factors, with “Placebo” and “No nausea” as the first levels. We should use the relevel() command to re-order the factor levels. nausea$group &lt;- relevel(nausea$group, ref=&quot;Active&quot;) nausea$side_effect &lt;- relevel(nausea$side_effect, ref=&quot;Nausea&quot;) str(nausea$group) ## Factor w/ 2 levels &quot;Active&quot;,&quot;Placebo&quot;: 2 2 2 2 2 2 2 2 2 2 ... str(nausea$side_effect) ## Factor w/ 2 levels &quot;Nausea&quot;,&quot;No nausea&quot;: 1 1 1 1 2 2 2 2 2 2 ... After confirming the factors are appropriately defined, we can construct our 2-by-2 table and view the expected frequencies. contTables(data=nausea, rows=group, cols=side_effect, exp=TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ────────────────────────────────────────────────────────────── ## group Nausea No nausea Total ## ────────────────────────────────────────────────────────────── ## Active Observed 15 35 50 ## Expected 9.500000 40.50000 50.00000 ## ## Placebo Observed 4 46 50 ## Expected 9.500000 40.50000 50.00000 ## ## Total Observed 19 81 100 ## Expected 19.000000 81.00000 100.00000 ## ────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 7.862248 1 0.0050478 ## N 100 ## ───────────────────────────────────── After confirming that there are no cells with small expected frequencies, we can interpret the chi-square test. The last section reports the chi-squared test statistic which has a value of 7.86 with 1 degree of freedom and a P-value of 0.005. If there are small values of expected frequencies, Fisher’s exact test can be requested using fisher = TRUE: contTables(data=nausea, rows=group, cols=side_effect, fisher = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ─────────────────────────────────────────── ## group Nausea No nausea Total ## ─────────────────────────────────────────── ## Active 15 35 50 ## Placebo 4 46 50 ## Total 19 81 100 ## ─────────────────────────────────────────── ## ## ## χ² Tests ## ────────────────────────────────────────────────────── ## Value df p ## ────────────────────────────────────────────────────── ## χ² 7.862248 1 0.0050478 ## Fisher&#39;s exact test 0.0094886 ## N 100 ## ────────────────────────────────────────────────────── 7.1.2 Summarised data When you only have the summarised date (for example, the cross-tabulated data), you need to enter the summarised data manually. As we did in Module 6, the 2-by-2 table can be entered as four lines of data: drug_aggregated &lt;- data.frame( group = c(&quot;Active&quot;, &quot;Active&quot;, &quot;Placebo&quot;, &quot;Placebo&quot;), side_effect = c(&quot;Nausea&quot;, &quot;No nausea&quot;, &quot;Nausea&quot;, &quot;No nausea&quot;), n = c(15, 35, 4, 46) ) The contTables() function is used in the usual way, specifying count=n. 7.2 Chi-squared test for tables larger than 2-by-2 Use the data in Example_7.2.rds. We use similar steps as described above for a 2-by-2 table. allergy &lt;- readRDS(&quot;data/examples/Example_7.2.rds&quot;) head(allergy) ## id asthma hdmallergy catallergy infection sex maternalasthma ## 1 1 No Yes No Yes Female No ## 2 2 Yes No No No Female No ## 3 3 Yes No No No Female No ## 4 4 No No No No Male No ## 5 4 Yes Yes Yes No Female No ## 6 5 Yes Yes Yes No Female No ## allergy_severity ## 1 Moderate allergy ## 2 Non-allergic ## 3 Non-allergic ## 4 Non-allergic ## 5 Moderate allergy ## 6 Moderate allergy contTables(data=allergy, rows=allergy_severity, cols=sex, pcCol=TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ────────────────────────────────────────────────────────────────────────────── ## allergy_severity Female Male Total ## ────────────────────────────────────────────────────────────────────────────── ## Non-allergic Observed 150 137 287 ## % within column 61.98347 53.10078 57.40000 ## ## Slight allergy Observed 50 70 120 ## % within column 20.66116 27.13178 24.00000 ## ## Moderate allergy Observed 27 32 59 ## % within column 11.15702 12.40310 11.80000 ## ## Severe allergy Observed 15 19 34 ## % within column 6.19835 7.36434 6.80000 ## ## Total Observed 242 258 500 ## % within column 100.00000 100.00000 100.00000 ## ────────────────────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 4.308913 3 0.2299813 ## N 500 ## ───────────────────────────────────── 7.3 McNemar’s test for paired proportions To perform this test in R, we will use the dataset Example_7.3.rds. drug &lt;- readRDS(&quot;data/examples/Example_7.3.rds&quot;) head(drug) ## druga drugb ## 1 Yes Yes ## 2 Yes Yes ## 3 Yes Yes ## 4 Yes Yes ## 5 Yes Yes ## 6 Yes Yes As usual, we should check that the variables being tabulated are factors, with the first level of the factor being the outcome of interest. We can use the relevel() function to re-order levels as necessary. str(drug$druga) ## Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 2 ... ## - attr(*, &quot;label&quot;)= chr &quot;Response to Drug A&quot; str(drug$drugb) ## Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 2 ... ## - attr(*, &quot;label&quot;)= chr &quot;Response to Drug B&quot; drug$druga &lt;- relevel(drug$druga, ref=&quot;Yes&quot;) drug$drugb &lt;- relevel(drug$drugb, ref=&quot;Yes&quot;) str(drug$druga) ## Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 1 1 1 1 1 1 1 1 1 ... str(drug$drugb) ## Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 1 1 1 1 1 1 1 1 1 ... We can use the contTablesPaired() function within the jmv library to conduct McNemar’s test of paired proportions: contTablesPaired(data=drug, rows=druga, cols=drugb) ## ## PAIRED SAMPLES CONTINGENCY TABLES ## ## Contingency Tables ## ─────────────────────────────── ## druga Yes No Total ## ─────────────────────────────── ## Yes 21 20 41 ## No 14 5 19 ## Total 35 25 60 ## ─────────────────────────────── ## ## ## McNemar Test ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 1.058824 1 0.3034837 ## N 60 ## ───────────────────────────────────── Note that contTablesPaired() does not calculate an exact P-value. To estimate the proportion in each of the paired samples, its difference, and the 95% confidence interval of the difference, we can use the mcNemarDiff() function which is stored in Microsoft Teams. ### Copied from Microsoft Teams mcNemarDiff &lt;- function(data, var1, var2, digits = 3) { if (!requireNamespace(&quot;epibasix&quot;, quietly = TRUE)) { stop(&quot;This function requires epibasix to be installed&quot;) } tab &lt;- table(data[[var1]], data[[var2]]) p1 &lt;- (tab[1, 1] + tab[1, 2]) / sum(tab) p2 &lt;- (tab[1, 1] + tab[2, 1]) / sum(tab) pd &lt;- epibasix::mcNemar(tab)$rd pd.cil &lt;- epibasix::mcNemar(tab)$rd.CIL pd.ciu &lt;- epibasix::mcNemar(tab)$rd.CIU print(paste0( &quot;Proportion 1: &quot;, format(round(p1, digits = digits), nsmall = digits), &quot;; Proportion 2: &quot;, format(round(p2, digits = digits), nsmall = digits) )) print(paste0( &quot;Difference in paired proportions: &quot;, format(round(pd, digits = digits), nsmall = digits), &quot;; 95% CI: &quot;, format(round(pd.cil, digits = digits), nsmall = digits), &quot; to &quot;, format(round(pd.ciu, digits = digits), nsmall = digits) )) } ### End copy mcNemarDiff(data = drug, var1 = &quot;druga&quot;, var2 = &quot;drugb&quot;, digits = 2) ## [1] &quot;Proportion 1: 0.68; Proportion 2: 0.58&quot; ## [1] &quot;Difference in paired proportions: 0.10; 95% CI: -0.11 to 0.31&quot; In this study of 60 participants, where each participant received both drugs, 41 (68%) responded to Drug A and 35 (58%) responded to Drug B. The difference in the proportions responding is estimated as 10% (95% CI -11% to 31%). There is no evidence that the response differed between the two drugs (McNemar’s chi-squared = 1.06 with 1df, P=0.30). "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
